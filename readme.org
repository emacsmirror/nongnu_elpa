* fj.el

This repo contains some basic functions for interacting with a Forgejo instance (such as [[https://codeberg.org][codeberg.org]]) from within Emacs.

It doesn't interact with =forge= / =magit=, which don't implement Gitea/Forgejo support and likely never will (see https://github.com/magit/forge/discussions/557). Nor does it attempt to follow their wonderful design (for now).

It just aims to cover a few of the bread and butter functions that will save you switching to the browser 80% of the time.

* getting started

To get going, first set =fj-host=,  =fj-user=, and =fj-token=. You can obtain a token from your profile settings on your Forgejo instance.

* repositories

Current repository detection should work partially automatically. If you find you are still being asked for the repo when calling a command from inside a repo with a Forgejo remote, check to make sure the local root directory matches the name of the Forgejo repo!

* features

Forgejo's API is vast. Currently =fj.el= just implements a few basic things:

- search and list repos
- list user's repos
- star repos from repo listing


- list repo issues
- open issue
- act on issue from issues listing (edit, edit title, comment, close, reopen, delete)
- view issue discussion (and act on issue as above)


- list PRs and view PR discussion


- create repo

* dependencies
- =magit-post=, =magit-process= (for obtaining current repo)
- [[https://codeberg.org/martianh/fedi.el][fedi.el]]

* commands index

#+BEGIN_SRC emacs-lisp :results table :colnames '("Binding" "Command" "Description") :exports results
  (let ((rows))
    (mapatoms
     (lambda (symbol)
       (when (and (string-match "^fj"
                                (symbol-name symbol))
                  (commandp symbol))
         (let* ((doc (car
                      (split-string
                       (or (documentation symbol t) "")
                       "\n")))
                ;; add more keymaps here
                ;; some keys are in sub 'keymap keys inside a map
                (maps) ; fj-mode-map))
                (binding-code
                 (let ((keys (where-is-internal symbol maps nil nil (command-remapping symbol))))
                   ;; just take first 2 bindings:
                   (if (> (length keys) 2)
                       (list (car keys) (cadr keys))
                     keys)))
                (binding-str (if binding-code
                                 (mapconcat #'help--key-description-fontified
                                            binding-code ", ")
                               "")))
           (push `(,binding-str ,symbol ,doc) rows)
           rows))))
    (sort rows (lambda (x y) (string-lessp (cadr x) (cadr y)))))
#+END_SRC

#+RESULTS:
| Binding | Command                       | Description                                                        |
|---------+-------------------------------+--------------------------------------------------------------------|
|         | fj-issue-close                | Close ISSUE in REPO or set to STATE.                               |
|         | fj-issue-comment              | Add comment to ISSUE in REPO.                                      |
|         | fj-issue-comment-edit         | Edit comment on ISSUE in REPO.                                     |
|         | fj-issue-create               | Create an issue in REPO.                                           |
|         | fj-issue-delete               | Delete ISSUE in REPO.                                              |
|         | fj-issue-edit                 | Edit ISSUE body in REPO.                                           |
|         | fj-issue-edit-title           | Edit ISSUE title in REPO.                                          |
|         | fj-issue-post-mode            | Major mode derived from `fedi-post-mode' by `define-derived-mode'. |
|         | fj-issue-view                 | View issue number NUMBER from REPO.                                |
|         | fj-issue-view-comment         | Comment on the issue currently being viewed.                       |
|         | fj-issue-view-edit            | Edit the issue currently being viewed.                             |
|         | fj-issue-view-mode            | Major mode for viewing an issue.                                   |
|         | fj-issue-view-reload          | Reload the current issue view.                                     |
|         | fj-issues-tl-close-issue      | Close current issue from tabulated issues listing.                 |
|         | fj-issues-tl-comment-issue    | Comment on issue from tabulated issues listing.                    |
|         | fj-issues-tl-create           | Create an issue in current repo.                                   |
|         | fj-issues-tl-delete-issue     | Delete current issue from tabulated issues listing.                |
|         | fj-issues-tl-edit-issue       | Edit issue from tabulated issues listing.                          |
|         | fj-issues-tl-edit-issue-title | Edit title of issue from tabulated issues listing.                 |
|         | fj-issues-tl-list-user-repos  | View a tabulated list of current user from issues listing.         |
|         | fj-issues-tl-reload           | Reload current issues tabulated list view.                         |
|         | fj-issues-tl-reopen-issue     | Reopen current issue from tabulated issues listing.                |
|         | fj-issues-tl-view-issue       | View current issue from tabulated issues listing.                  |
|         | fj-kill-all-buffers           | Kill all fj buffers.                                               |
|         | fj-list-issue-mode            | Major mode for browsing a tabulated list of issues.                |
|         | fj-list-issues                | Display ISSUES in a tabulated list view.                           |
|         | fj-list-issues-all            | Display all ISSUES for REPO in tabulated list view.                |
|         | fj-list-issues-closed         | Display closed ISSUES for REPO in tabulated list view.             |
|         | fj-list-issues-cycle          | Cycle between listing of open, closed, and all issues.             |
|         | fj-list-own-repos             | List repos for `fj-user'.                                          |
|         | fj-list-pull-reqs             | List pull requests for REPO.                                       |
|         | fj-pull-req-comment           | Add comment to PULL in REPO.                                       |
|         | fj-pull-req-comment-edit      | Edit a comment on PULL in REPO.                                    |
|         | fj-repo-create                | Create a new repo.                                                 |
|         | fj-repo-search                | Search repos for QUERY.                                            |
|         | fj-repo-search-tl             | Search repos for QUERY, and display a tabulated list of results.   |
|         | fj-repo-tl-list-issues        | View issues of current repo from tabulated repos listing.          |
|         | fj-repo-tl-list-user-repos    | View repos of current entry user from tabulated repos listing.     |
|         | fj-repo-tl-mode               | Mode for displaying a tabulated list of repo search results.       |
|         | fj-switch-to-buffer           | Switch to a live fj buffer.                                        |
|         | fj-user-repo-tl-list-issues   | View issues of current repo from tabulated user repos listing.     |
|         | fj-user-repo-tl-mode          | Mode for displaying a tabulated list of user repos.                |
|         | fj-user-repo-tl-star          | Star current repo from tabulated user repos listing.               |
|         | fj-user-repo-tl-unstar        | Unstar current repo from tabulated user repos listing.             |
|         | fj-user-repos-tl              | View a tabulated list of respos for USER.                          |
